CFLAGS += -Iinclude -Ibuild/include -DDLB -g -Werror -O0

: util/makedefs.c util/panic.c src/alloc.c src/objects.c src/monst.c |> cc -Iinclude -DDLB %f -o %o |> makedefs
: makedefs |> ./makedefs |> src/monstr.c src/vis_tab.c include/onames.h include/filename.h include/date.h include/pm.h include/vis_tab.h dat/data dat/dungeon.pdf dat/options dat/quest.dat dat/rumors dat/oracles

: util/dgn_comp.y |> bison -d %f -o build/dgn_yacc.c; mv build/dgn_yacc.h include/dgn_comp.h; mv build/dgn_yacc.c src/ |> src/dgn_yacc.c include/dgn_comp.h
: util/dgn_comp.l |> flex -o %o %f |> src/dgn_lex.c
: util/lev_comp.y |> bison -d %f -o build/lev_yacc.c; mv build/lev_yacc.h include/lev_comp.h; mv build/lev_yacc.c src/ |> src/lev_yacc.c include/lev_comp.h
: util/lev_comp.l |> flex -o %o %f |> src/lev_lex.c

SRC := src/allmain.c src/alloc.c src/apply.c src/artifact.c src/attrib.c src/ball.c src/bones.c src/borg.c src/botl.c src/cmd.c src/dbridge.c src/decl.c src/detect.c src/dig.c src/display.c src/dlb.c src/do.c src/do_name.c src/do_wear.c src/dog.c src/dogmove.c src/dokick.c src/dothrow.c src/drawing.c src/dungeon.c src/eat.c src/end.c src/engrave.c src/exper.c src/explode.c src/extralev.c src/files.c src/fountain.c src/hack.c src/hacklib.c src/invent.c src/light.c src/lock.c src/mail.c src/makemon.c src/mapglyph.c src/mcastu.c src/mhitm.c src/mhitu.c src/minion.c src/mklev.c src/mkmap.c src/mkmaze.c src/mkobj.c src/mkroom.c src/mon.c src/mondata.c src/monmove.c src/monst.c src/mplayer.c src/mthrowu.c src/muse.c src/music.c src/o_init.c src/objects.c src/objnam.c src/options.c src/pager.c src/pickup.c src/pline.c src/polyself.c src/potion.c src/pray.c src/priest.c src/quest.c src/questpgr.c src/read.c src/rect.c src/region.c src/restore.c src/rip.c src/rnd.c src/role.c src/rumors.c src/save.c src/shk.c src/shknam.c src/sit.c src/sounds.c src/sp_lev.c src/spell.c src/steal.c src/steed.c src/teleport.c src/timeout.c src/topten.c src/track.c src/trap.c src/u_init.c src/uhitm.c src/vault.c src/version.c src/vision.c src/weapon.c src/were.c src/wield.c src/windows.c src/wizard.c src/worm.c src/worn.c src/write.c src/zap.c src/gypsy.c src/tech.c src/unicode.c
SYSSRC := sys/share/ioctl.c sys/share/unixtty.c sys/unix/unixmain.c sys/unix/unixunix.c sys/unix/unixres.c
GENSRC := src/monstr.c src/vis_tab.c
TTY_SRC := win/tty/*.c
CURSES_SRC := win/curses/*.c
PROXY_SRC := win/proxy/*.c
SLASHEMSRC := $(SRC) $(SYSSRC) $(GENSRC) $(TTY_SRC) $(CURSES_SRC)

: foreach src/lev_yacc.c src/lev_lex.c src/dgn_yacc.c src/dgn_lex.c util/dgn_main.c util/dlb_main.c util/lev_main.c util/panic.c | include/*.h |> cc $(CFLAGS) -c %f -o %o |> %B.o

: foreach $(SLASHEMSRC) | include/*.h |> cc $(CFLAGS) -c %f -o %o |> %B.o {slashemsrc}
: {slashemsrc} |> cc -lncursesw -o %o %f |> slashem


: dlb_main.o alloc.o panic.o dlb.o |> cc %f -o %o |> dlb

: lev_yacc.o lev_lex.o lev_main.o alloc.o panic.o drawing.o decl.o objects.o monst.o |> cc %f -o %o |> lev_comp
: dgn_yacc.o dgn_lex.o dgn_main.o alloc.o panic.o |> cc %f -o %o |> dgn_comp

: dgn_comp dat/dungeon.pdf |> ./dgn_comp dat/dungeon.pdf |> dat/dungeon
#: foreach dat/*.des | lev_comp |> ./lev_comp %f |> %B.lev


: dlb dat/help dat/hh dat/cmdhelp dat/history dat/opthelp dat/wizhelp dat/gypsy.txt dat/data dat/options dat/oracles dat/quest.dat dat/rumors |> cd dat; ../dlb cf nhshare help hh cmdhelp history opthelp wizhelp gypsy.txt data options oracles quest.dat rumors; mv nhshare .. |> nhshare
